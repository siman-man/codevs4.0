### 考察

- 初期は200マスの何処かに城が現れる
- 200マス中最大で221マスの視野を確保できる。
- 残り5000マスの中の10個が資源マス
- とにかく最初は資源マスを見つけること

- アサシンが最短で攻めてくる場合(59ターン、お互いが常に近づいて相手が最速で拠点とアサシンを生産)

- 初期配置で城が一番接近する場合、最短で118マスかかる
- お互いが最短で進んだとして最短57ターン目で視野に入る
- 少なくとも最初に拠点を作るのには50ターンかかるはずなので、序盤は攻められる心配はなさそう
- このゲーム資源を集める方法が少ない
- 資源マスは20個しか無いので、最大5 * 20 + 10の110資源を1ターンで得られる

- 15ターン目で資源を見つけて5体のワーカが待機した場合(525資源)
- 15ターン目で資源を見つけて9体のワーカが待機した場合(665資源)

### 戦略

- 序盤は村を作って視界を確保するのが良さそう(資源の場所を把握 & 敵の位置を把握)
- このゲーム基本的に防衛側有利なので、自分から攻めることはしない。
- 拠点を攻める場合は、自分に不利なキャラクターが出てくる可能性があるので基本的には責めない
- 戦闘中のダメージ効率を考えるとまとまって行動したほうが有利
- 小隊を作って行動させる?(アサシン5体で単体で行動しているユニットを1ターンキルできる)
- 敵のタイプとして、城に拠点を作られるパターンが一番攻略に時間がかかる

- 100ターン(資源集め)
- アサシン生成(30ターン)
- 拠点作成(1ターン)
- 突撃(50ターン)
- 城破壊(20ターン)

- lila(自軍の城を囲んである程度数がまとまったら突撃させる、資源マスに村を作る)
- grun(最初はバラバラに、相手の軍を見てから有利なユニットを生成する)
- chokudai(資源マスに村を作る)

### 序盤

- 最初の資源を見つけるのにどれぐらいかかるか。

### 防衛戦

- ワーカ5体の戦力(アサシン1体と相打ち、騎士、闘であれば勝てる)

### 評価関数の作り方について

- フィールドを俯瞰できるユニットにつけさせる
- ユニットごとに算出してその合計値を評価とする

### 攻めるタイミングについて

- 基本的にアサシンで攻めることにはなりそう
- アサシンが優秀だから

### 実行時間について

- 全部で41ステージ
- 使用できる時間は1時間
- 各1000ターンが上限なので41 * 1000で41000ターン
- 1ターンに使用できる平均時間は約87ms


### 修正予定
- [ ] 2P側でも1P側と同じような成績を出せるようにする。(座標のコンバートを入れれば大丈夫と予測)

### ルールが変更になりました
- 相手AIのワーカ以外の収入が周回ごとに増えていく(
  - 1週目は+10
  - 2週目は+20
- extraステージの追加(silver)

### 収入増加による影響
- grun相手にはまず勝てなくなる(速攻型だと2つめの拠点を作られた段階で終了)
- 圧倒的な物量差が出てくる

### 対策
- 収入効率では絶対に勝てないので、敵AIに対して適切な対応が求められる
- じゃんけんに勝ち続ける必要がある(相手の弱点のユニットを生成)
- 相手の収入源を確実に潰していく(村破壊)
- 防衛しつつ相手の拠点を潰していく
- 城に拠点を作らないタイプの敵に対しては速攻が有効
  - chokudai
  - colun
  - silver
  - gelb
  - rosa
- 城に拠点を作るタイプに関しては対策が必要
  - grun
  - lila
  - schwch
  - zinober

### 村の破壊について

- HP20000
- 500 * 40
- 100 / 5 * 40 = 800
- 1000 * 20
- 100 / 10 * 20 = 200

### 収入の差

- 1週目 +10
- 2週目 +20

### 自軍の城に基地を作成する条件
敵の距離が自軍の城から30を切った場合


### 実装するもの
- [x] kの値をノードから取得できるように
- [ ] そのマスで与えることが可能な攻撃力
  - [ ] そのマスにいる敵の数と種類を把握
  - [ ] 各ユニット毎に与えられるダメージを計算
- [ ] そのマスで受ける可能性のあるダメージ


### 戦略ツリー
速攻で攻める -> 成功
    |
    v
   失敗 -> 自軍の城に基地を作成する


# 勝ちパターンについて
ルール変更前と変更後で大きく戦い方が変化したので、そのことについてまとめている

## 従来
従来の方法だとsilverを除き速攻型が有効

速攻型でもgrunを除き勝てることが確認できている（勝率は低いが）

## ルール変更後
相手の収入が増えたことによって、相手との資源差が圧倒的なものになっている。この場合、うまく立ちまわって対処するとしても視界
の幅が狭いため戦略的に取れる戦法が、闇討ちぐらいしかない。要はAI殺し。この闇討ちに対処できるAIは現時点でlilaぐらいなのだが、
lilaも城の視界の範囲外のユニットまでは見れていないので、そこに隙ができてしまう。

## 案1
lilaの応用形

自分の城と中間に拠点を作成し、ひたすらユニットを生成。ある程度の数になったら突撃を仕掛ける

従来の攻略法通りに中間地点に拠点を作成する、もしその間に敵が迫っている場合は自軍の城にも拠点を作成。
敵ユニットの状態を確認しながら、拠点の周りのユニットを増やしていく。

攻撃に失敗した場合は、一度拠点に戻る。失敗の条件は、敵戦力が思った以上に大きいとき、突撃軍の戦力が大幅に削られたとき。

資源マスが潰されても、その間に生成したユニットで突撃すればどうにでもなるんじゃないか戦法。

* 確実に敵の城を把握しておく必要がある。ワーカで把握できるかもしれないが+20だと途中で倒される可能性がある。
* 突撃するユニットはなるべく敵の大軍に飛び込まないように、あくまで城を落とすことに集中する

### メリット
* 速攻型を崩すことなく、ディフェンス力のUPが期待される。
* 一瞬の攻撃力はピカイチ

### デメリット
* 攻撃が一度失敗すれば後は敗北あるのみ
* たぶん見ててつまらないAIになってる

### 問題点
* 相手の収入が増えた際にどこまでユニットを貯めこむことが出来るのか。

### 突撃軍の構成について
* 城まで戦力を保持させつつ、相手の城にダメージを与えるには。かつ短期的に軍隊を編成する必要がある。
* 攻撃は最初に1回に集中させる、2回目以降の攻撃は出来ないものと判断

### 実装に必要なもの

- [x] 資源が40になるまでは探索を続ける。（戦況に応じて変化させるのはあり)
- [x] 相手の城の近くに拠点の作成を行う。(60-70マス以内に作れると後が楽)
- [x] 統率がとれた行動が取れる。(1マスに11体以上いられなくする)
- [x] 自分の城の周りに陣形を作成する。（城をリーダにすればいけそう)
- [ ] リーダのスイッチ（仮に途中でリーダが倒れても、統率した行動が取れるように）
- [ ] 探索仕切ったワーカは相手の城を目指すように
- [ ] 撤退モードを作成し、撤退先を目標に出来るようにする。
- [ ] unit->destにある程度一元化出来るようにしておく。
